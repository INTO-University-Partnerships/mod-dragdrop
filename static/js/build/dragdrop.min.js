!function e(t,n,r){function s(i,c){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!c&&a)return a(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[i]={exports:{}};t[i][0].call(u.exports,function(e){var n=t[i][1][e];return s(n?n:e)},u,u.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(e,t,n){"use strict";var r=angular.module("dragdropApp",["dragdrop.controllers","dragdrop.directives","dragdrop.services","dragdrop.filters","ngRoute","ngDragDrop","ui.bootstrap"]);r.constant("CONFIG",window.CONFIG),delete window.CONFIG,r.config(["$routeProvider","$httpProvider","CONFIG",function(e,t,n){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.when("/words/sentence",{templateUrl:n.partialsUrl+"route/sentence.twig",controller:"sentenceCtrl"}).when("/words/sentence/:id",{templateUrl:n.partialsUrl+"route/sentence.twig",controller:"sentenceCtrl"}).when("/words",{templateUrl:n.partialsUrl+"route/wordBlocks.twig",controller:"manageCtrl"}).when("/attempt",{templateUrl:n.partialsUrl+"route/attempt.twig",controller:"attemptCtrl"}).when("/previous",{templateUrl:n.partialsUrl+"route/previousAttempts.twig",controller:"previousAttemptsCtrl"}).when("/attempts",{templateUrl:n.partialsUrl+"route/attemptsReport.twig",controller:"attemptsReportCtrl"}).when("/attempts/:userid",{templateUrl:n.partialsUrl+"route/previousAttempts.twig",controller:"previousAttemptsCtrl"}).when("/settings",{templateUrl:n.partialsUrl+"route/settings.twig",controller:"settingsCtrl"}).otherwise({redirectTo:function(){return n.capabilities.manage_word_blocks?"/words":"/attempt"}})}])},{}],2:[function(e,t,n){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("./services"),e("./filters")},{"./angular-app":1,"./controllers":3,"./directives":4,"./filters":6,"./services":7}],3:[function(e,t,n){"use strict";var r=angular.module("dragdrop.controllers",[]);r.controller("manageCtrl",["$scope","CONFIG","$location",function(e,t,n){e.messages={},t.capabilities.manage_word_blocks||n.path("/attempt")}]),r.controller("wordBlocksCtrl",["$scope","apiSrv","$timeout","$window","CONFIG","tagSrv",function(e,t,n,r,s,o){e.blocks=[],e.newBlock="",e.timeoutPromise=null,e.tags=[],e.getBlocks=function(){t.getAll("word_block").then(function(t){e.blocks=t},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=n(function(){e.getBlocks()},1e4)})},e.getTags=function(){o.get().then(function(t){e.tags=t},function(t){e.messages.error=t.errorMessage})},e.addNewBlockDisabled=function(){return 0===e.newBlock.length},e.addNewBlock=function(){t.post("word_block",{wordblock:e.newBlock}).then(function(t){e.messages.success=t.successMessage,e.newBlock="",e.getBlocks()},function(t){e.messages.error=t.errorMessage,e.getBlocks()})},e.editBlock=function(r){n.cancel(e.timeoutPromise),t.put("word_block",r.id,{tagid:r.tagid,wordblock:r.wordblock}).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})},e.deleteBlock=function(o){n.cancel(e.timeoutPromise),n(function(){return r.confirm(s.messages.confirm_delete_word_block)?void t["delete"]("word_block",o).then(function(){e.messages.success=s.messages.word_block_deleted_successfully,e.getBlocks()},function(t){e.messages.error=t.errorMessage,e.getBlocks()}):void e.getBlocks()},1)},e.stopAutoRefresh=function(){n.cancel(e.timeoutPromise)},e.startAutoRefresh=function(){e.getBlocks()},e.$on("$destroy",function(){n.cancel(e.timeoutPromise)}),e.getBlocks(),e.getTags()}]),r.controller("sentenceListCtrl",["$scope","apiSrv","$timeout","$window","CONFIG",function(e,t,n,r,s){e.sentences=[],e.timeoutPromise=null,e.getSentences=function(){t.getAll("sentence").then(function(t){e.sentences=t},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=n(function(){e.getSentences()},1e4)})},e.deleteSentence=function(o){n.cancel(e.timeoutPromise),n(function(){return r.confirm(s.messages.confirm_delete_sentence)?void t["delete"]("sentence",o).then(function(){e.messages.success=s.messages.sentence_deleted_successfully,e.getSentences()},function(t){e.messages.error=t.errorMessage,e.getSentences()}):void e.getSentences()},1)},e.$on("$destroy",function(){n.cancel(e.timeoutPromise)}),e.getSentences()}]),r.controller("sentenceCtrl",["$scope","apiSrv","$routeParams","$location","CONFIG","$route",function(e,t,n,r,s,o){s.capabilities.manage_sentences||r.path("/attempt"),e.id=n.id?n.id:0,e.blocks=[],e.placed={},e.messages={},e.loading=!0,e.locked=!0,e.rendered={},e.getWordBlocks=function(n){t.getAll("word_block").then(function(t){e.blocks=t},function(t){e.messages.error=t.errorMessage})["finally"](function(){n?e.$evalAsync(function(){e.getSentence(n)}):e.loading=!1})},e.getSentence=function(n){t.get("sentence_words",n).then(function(t){e.placed.wordblocks=t.wordblocks,e.$broadcast("sentenceLoaded")},function(t){e.messages.error=t.errorMessage})},e.removeWordBlock=function(t){for(var n in e.placed.wordblocks)if(e.placed.wordblocks[n].wordblockid===t)return e.placed.wordblocks.splice(n,1),void e.$broadcast("wordRemoved",t)},e.setLoading=function(t){e.loading=t},e.saveSentence=function(){0!==e.placed.wordblocks.length&&(e.placed.wordblocks.forEach(function(e,t){return e.position=parseInt(t)+1}),e.id?e.putSentence({wordblocks:e.placed.wordblocks}):e.postSentence({wordblocks:e.placed.wordblocks}))},e.postSentence=function(n){e.locked=!0,t.post("sentence_words",n).then(function(t){e.messages.success=t.successMessage,e.id=t.sentence.id,r.path("/words/sentence/"+t.sentence.id)},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.locked=!1})},e.putSentence=function(n){e.locked=!0,t.put("sentence_words",e.id,n).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.locked=!1})},e.reset=function(){e.getWordBlocks(),e.$broadcast("sentenceReset")};var i=o.current.originalPath;e.$on("$locationChangeSuccess",function(){"undefined"!=typeof o.current.originalPath&&0===o.current.originalPath.indexOf(i)&&(o.current=i)}),e.close=function(){r.path("#words")},e.$watch("placed.wordblocks",function(){e.locked=!(e.placed.wordblocks&&e.placed.wordblocks.length>0)}),e.getWordBlocks(e.id)}]),r.controller("attemptCtrl",["$scope","apiSrv","CONFIG","$q","$sce","$modal","tagSrv",function(e,t,n,r,s,o,i){e.blocks=[],e.placed={wordblocks:[]},e.messages={},e.tags=[],e.settings={instruction:"",feedback:{},hint:"",num_attempts:0,feedback_correct:""},e.remaining_attempts=0,e.user={},e.rendered={},e.loading=!0,e.locked=!0,e.getWordBlocks=function(){var n=r.defer();return t.getAll("word_block").then(function(t){t.sort(function(){return.5-Math.random()}),e.blocks=t,n.resolve()},function(t){n.reject(),e.messages.error=t.errorMessage}),n.promise},e.removeWordBlock=function(t){for(var n in e.placed.wordblocks)if(e.placed.wordblocks[n].wordblockid===t)return e.placed.wordblocks.splice(n,1),void e.$broadcast("wordRemoved",t)},e.getSettings=function(){var s=r.defer();return t.get("settings",n.instanceid).then(function(t){e.prepareSettings(t,s),e.settings.display_labels?e.getTags().then(function(){s.resolve()}):s.resolve()},function(t){e.messages.error=t.errorMessage,s.reject()}),s.promise},e.getTags=function(){var t=r.defer();return i.get().then(function(n){e.tags=n,t.resolve()},function(n){e.messages.error=n.errorMessage,t.reject()}),t.promise},e.getUser=function(){var n=r.defer();return t.getUser(0).then(function(t){n.resolve(),e.user=t}),n.promise},e.prepareSettings=function(t){e.settings.instruction=s.trustAsHtml(t.dragdrop.instruction),e.settings.hint=s.trustAsHtml(t.dragdrop.hint),e.settings.feedback_correct=s.trustAsHtml(t.dragdrop.feedback_correct),t.feedback.forEach(function(t){var n=t.attempt;e.settings.feedback[n]=s.trustAsHtml(t.feedback)}),e.settings.num_attempts=parseInt(t.dragdrop.num_attempts),e.settings.display_labels=Boolean(parseInt(t.dragdrop.display_labels))},e.getUserAttempts=function(){var n=r.defer();return t.getAll("user_attempt",{userid:e.user.id}).then(function(t){e.prepareUserAttempts(t),n.resolve()},function(t){e.messages.error=t.errorMessage,n.reject()}),n.promise},e.prepareUserAttempts=function(t){var r=t.some(function(e){return 1===parseInt(e.correct)&&0===parseInt(e.reset)}),s=t.filter(function(e){return 0===parseInt(e.reset)}).length;e.remaining_attempts=parseInt(e.settings.num_attempts-s),r?(e.messages.success=n.messages.activity_completed,e.remaining_attempts=0,e.locked=!0):e.remaining_attempts<=0?(e.remaining_attempts=0,e.messages.error=n.messages.num_attempts_reached,e.locked=!0):e.locked=!1},e.submitAttempt=function(){var n=function(){e.placed.wordblocks.forEach(function(e,t){return e.position=parseInt(t)+1});var n={wordblocks:e.placed.wordblocks},r={userid:e.user.id};t.post("user_attempt",n,r).then(function(t){e.setFeedback(parseInt(t.correct),parseInt(t.contributing_attempts))},function(t){e.messages.error=t.errorMessage})};e.submitDialog(e.placed.wordblocks,n)},e.setFeedback=function(t,r){t?e.feedbackDialog(e.settings.feedback_correct,n.messages.correct_attempt_title):e.feedbackDialog(e.settings.feedback[r],n.messages.incorrect_attempt_title),e.getUserAttempts()},e.feedbackDialog=function(e,t){o.open({templateUrl:n.partialsUrl+"dialogs/feedbackDialog.twig",controller:"feedbackModalCtrl",resolve:{content:function(){return e},title:function(){return t}}})},e.hint=function(){e.feedbackDialog(e.settings.hint,n.messages.hint_dialog_title)},e.submitDialog=function(t,r){o.open({templateUrl:n.partialsUrl+"dialogs/attemptDialog.twig",controller:"submissionModalCtrl",resolve:{sentence:function(){var n=[],r=e.blocks.map(function(e){return e.id});return t.forEach(function(t){var s=r.indexOf(t.wordblockid);n.push(e.blocks[s].wordblock)}),n.join(" ")},callback:function(){return r}}})},e.reset=function(){e.getWordBlocks(),e.$broadcast("sentenceReset")},e.init=function(){e.getUser().then(function(){e.getSettings().then(function(){e.getWordBlocks().then(function(){e.getUserAttempts().then(function(){e.loading=!1})})})})},e.init()}]),r.controller("previousAttemptsCtrl",["$scope","apiSrv","CONFIG","$sce","$q","$routeParams","$timeout","$window",function(e,t,n,r,s,o,i,c){e.messages={},e.attempts={previous:[],reset:[]},e.loading=!0,e.timeoutPromise=null,e.userid=o.userid?o.userid:0,e.reporting=0!==e.userid,e.user={},e.remaining_attempts=0,e.settings={},e.manageAttempts=n.capabilities.manage_attempts,e.getAttemptsForUser=function(){i.cancel(e.timeoutPromise);var n=s.defer();return t.getAll("user_attempt",{userid:e.user.id}).then(function(t){t.sort(e.sortByCreated),t.forEach(function(e){return e.correct=1===parseInt(e.correct)}),e.groupAttempts(t),n.resolve()},function(t){e.messages.error=t.errorMessage,n.reject()})["finally"](function(){e.prepareFeedback(),e.calculateRemainingAttempts(),e.loading=!1,e.timeoutPromise=i(function(){e.getAttemptsForUser(e.user.id)},1e4)}),n.promise},e.reset=function(){i.cancel(e.timeoutPromise),i(function(){return c.confirm(n.messages.reset_attempts)?void t.resetAttempts({userid:e.user.id}).then(function(t){e.messages.success=t.success,e.getAttemptsForUser()},function(t){e.messages.error=t.errorMessage,e.getAttemptsForUser()}):void e.getAttemptsForUser()},1)},e.groupAttempts=function(t){e.attempts.previous=[],e.attempts.reset=[];for(var n in t)Boolean(parseInt(t[n].reset))?e.attempts.reset.push(t[n]):e.attempts.previous.push(t[n])},e.calculateRemainingAttempts=function(){var t=e.attempts.previous.filter(function(e){return 0===parseInt(e.reset)}).length;e.remaining_attempts=parseInt(e.settings.dragdrop.num_attempts)-t},e.getUser=function(n){var r=s.defer();return t.getUser(n).then(function(t){e.user=t,r.resolve()}),r.promise},e.getSettings=function(){var r=s.defer();return t.get("settings",n.instanceid).then(function(t){e.settings=t,r.resolve()},function(t){e.messages.error=t.errorMessage,r.reject()}),r.promise},e.prepareFeedback=function(){var t={};e.settings.feedback.forEach(function(e){t[e.attempt]=e.feedback}),e.setFeedbackOnAttempts(e.attempts.previous,t),e.setFeedbackOnAttempts(e.attempts.reset,t)},e.setFeedbackOnAttempts=function(t,n){t.forEach(function(t){var s="";1===parseInt(t.correct)?(e.remaining_attempts=0,s=r.trustAsHtml(e.settings.dragdrop.feedback_correct)):t.attempt in n&&(s=r.trustAsHtml(n[t.attempt])),t.feedback=s})},e.$on("$destroy",function(){i.cancel(e.timeoutPromise)}),e.sortByCreated=function(e,t){return e.timecreated>t.timecreated?-1:e.timecreated<t.timecreated?1:0}}]),r.controller("commentsCtrl",["$scope","apiSrv","CONFIG","$timeout","$window",function(e,t,n,r,s){e.comments=[],e.manageComments=n.capabilities.manage_comments,e.timeoutPromise=null,e.comment="",e.getComments=function(){r.cancel(e.timeoutPromise),t.getUserComments(e.user.id).then(function(t){e.comments=t},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=r(function(){e.getComments()},1e4)})},e.$on("$destroy",function(){r.cancel(e.timeoutPromise)}),e.addComment=function(){t.post("comment",{userid:e.user.id,comment:e.comment}).then(function(t){e.messages.success=t.successMessage,e.getComments()},function(t){e.messages.error=t.errorMessage})},e.deleteComment=function(o){r.cancel(e.timeoutPromise),r(function(){return s.confirm(n.messages.confirm_delete_comment)?void t["delete"]("comment",o,{userid:e.userid}).then(function(){e.messages.success=n.messages.comment_deleted_successfully,e.getComments()},function(t){e.messages.error=t.errorMessage,e.getComments()}):void e.getComments()},1)},e.editComment=function(n){r.cancel(e.timeoutPromise),t.put("comment",n.id,{comment:n.comment,userid:e.user.id}).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage})},e.init=function(){e.getUser(e.userid).then(function(){e.getSettings().then(function(){e.getAttemptsForUser()}),e.getComments()})},e.stopAutoRefresh=function(){r.cancel(e.timeoutPromise)},e.startAutoRefresh=function(){e.getComments()},e.init()}]),r.controller("settingsCtrl",["$scope","apiSrv","CONFIG","$sce","$location",function(e,t,n,r,s){n.capabilities.manage_settings||s.path("/attempt"),e.messages={},e.form={num_attempts:0,display_labels:!1,instruction:{},hint:{},feedback_correct:{},feedback:{}},e.getSettings=function(){t.get("settings",n.instanceid).then(function(t){e.form.num_attempts=parseInt(t.dragdrop.num_attempts),e.form.display_labels=Boolean(parseInt(t.dragdrop.display_labels)),e.form.instruction.html=r.trustAsHtml(t.dragdrop.instruction),e.form.instruction.raw=t.dragdrop.instruction,e.form.hint.html=r.trustAsHtml(t.dragdrop.hint),e.form.hint.raw=t.dragdrop.hint,e.form.feedback_correct.html=r.trustAsHtml(t.dragdrop.feedback_correct),e.form.feedback_correct.raw=t.dragdrop.feedback_correct,t.feedback.forEach(function(t){var n=t.attempt;e.form.feedback[n]={html:r.trustAsHtml(t.feedback),raw:t.feedback}}),e.initialiseFeedback()},function(t){e.messages.error=t.errorMessage})},e.saveSettings=function(n){t.put("settings",0,n).then(function(t){e.messages.success=t.successMessage},function(t){e.messages.error=t.errorMessage,e.getFeedback()})["finally"](function(){e.getSettings()})},e.initialiseFeedback=function(){for(var t=1;t<=e.form.num_attempts;t++)t in e.form.feedback||(e.form.feedback[t]={raw:"",html:""}),e.watchFeedback(t);for(var n in e.form.feedback)n>e.form.num_attempts&&delete e.form.feedback[n]},e.watchFeedback=function(t){e.$watch("form.feedback["+t+"].html",function(){if("undefined"!=typeof e.form.feedback[t]){var n=r.getTrustedHtml(e.form.feedback[t].html);n!==e.form.feedback[t].raw&&(e.form.feedback[t].raw=n,e.saveSettings({feedback:{attempt:parseInt(t),html:n}}))}})},e.displayLabelsChanged=function(){e.initialiseFeedback(),e.saveSettings({display_labels:e.form.display_labels})},e.attemptsChanged=function(){e.initialiseFeedback(),e.saveSettings({num_attempts:e.form.num_attempts})},e.$watch("form.instruction.html",function(){var t=r.getTrustedHtml(e.form.instruction.html);t!==e.form.instruction.raw&&(e.form.instruction.raw=t,e.saveSettings({instruction:t}))}),e.$watch("form.hint.html",function(){var t=r.getTrustedHtml(e.form.hint.html);t!==e.form.hint.raw&&(e.form.hint.raw=t,e.saveSettings({hint:t}))}),e.$watch("form.feedback_correct.html",function(){var t=r.getTrustedHtml(e.form.feedback_correct.html);t!==e.form.feedback_correct.raw&&(e.form.feedback_correct.raw=t,e.saveSettings({feedback_correct:t}))}),e.resetMessages=function(){e.messages.success="",e.messages.error=""},e.getSettings()}]),r.controller("attemptsReportCtrl",["$scope","apiSrv","CONFIG","$location","$timeout","attemptFilterSrv",function(e,t,n,r,s,o){n.capabilities.view_attempts||r.path("/attempt"),e.messages={},e.attempts=[],e.currentPage=0,e.total=null,e.perPage=10,e.timeoutPromise=null,e.filters=o.filters,e.prevFilterQ=o.filters.q,e.sortDefaults={user:"ASC",lastattempt:"DESC",numattempts:"DESC",completed:"DESC"},e.getPageOfAttempts=function(n){s.cancel(e.timeoutPromise),t.getAttempts(n,e.perPage,e.filters).then(function(t){e.attempts=t.attempts,e.total=t.total},function(t){e.messages.error=t.errorMessage})["finally"](function(){e.timeoutPromise=s(function(){e.getPageOfAttempts(e.currentPage)},1e4)})},e.filterQChanged=function(){s.cancel(e.timeoutPromise),e.timeoutPromise=s(function(){e.prevFilterQ!==e.filters.q?(e.prevFilterQ=e.filters.q,e.filterChanged()):e.timeoutPromise=s(function(){e.getPageOfAttempts(e.currentPage)},1e4)},1e3)},e.sortAttempts=function(t){s.cancel(e.timeoutPromise),e.filters.sort===t?e.filters.direction="ASC"===e.filters.direction?"DESC":"ASC":e.filters.direction=e.sortDefaults[t],e.filters.sort=t,e.getPageOfAttempts(e.currentPage)},e.filterChanged=function(){e.currentPage=0,e.getPageOfAttempts(e.currentPage)},e.$on("$destroy",function(){s.cancel(e.timeoutPromise)}),e.viewAttempts=function(e){r.path("/attempts/"+e)},e.getPageOfAttempts(e.currentPage)}]),r.controller("feedbackModalCtrl",["$scope","$modalInstance","content","title",function(e,t,n,r){e.content=n,e.title=r,e.close=function(){t.close()}}]),r.controller("submissionModalCtrl",["$scope","$modalInstance","sentence","callback",function(e,t,n,r){e.sentence=n,e.cancel=function(){t.close()},e.submit=function(){t.close(),r()}}]),r.controller("editorModalCtrl",["$scope","$modalInstance","id","content","title","save","resetMessages",function(e,t,n,r,s,o,i){e.id=n,e.content=r,e.title=s,e.save=o,e.resetMessages=i,e.oldContent=r.html,e.ok=function(){t.close()},e.cancel=function(){e.resetMessages(),e.content.html=e.oldContent,t.dismiss("cancel")}}])},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var s=e("./dropped-block"),o=r(s),i=angular.module("dragdrop.directives",[]);i.directive("tinyMce",["CONFIG","$interval","$sce",function(e,t,n){return{restrict:"A",replace:!0,scope:{id:"@dialogId",content:"=content"},link:function(e,t){t.attr("id",e.id)},controller:["$scope",function(r){r.intervalPromise=null,r.mconfig={mode:"exact",relative_urls:!1,language:"en",content_css:e.editorCSS,directionality:"ltr",theme:"advanced",skin:"moodle",apply_source_formatting:!0,plugins:"lists,table,style,directionality",gecko_spellcheck:!0,elements:r.id,setup:function(e){e.onInit.add(function(e){e.selection.setContent(r.content.html)}),e.onChange.add(function(e,t){r.content.html=n.trustAsHtml(t.content)})}},r.initialise=function(){0!==jQuery("#"+r.id).length&&(tinyMCE.init(r.mconfig),t.cancel(r.intervalPromise))},r.intervalPromise=t(function(){r.initialise()},100),r.initialise()}]}}]),i.directive("editorDialog",["CONFIG","$interval","$modal",function(e,t,n){return{restrict:"A",replace:!1,scope:{id:"@dialogId",content:"=content",title:"=title",resetMessages:"&resetMessages"},link:function(e,t){var n=t.parent().parent().find(".editor-html");n.bind("click",function(){e.open()}),t.bind("click",function(){e.open()})},controller:["$scope",function(t){t.open=function(r){n.open({templateUrl:e.partialsUrl+"dialogs/settingsDialog.twig",controller:"editorModalCtrl",size:r,resolve:{id:function(){return t.id},content:function(){return t.content},title:function(){return t.title},save:function(){return function(){t.save()}},resetMessages:function(){return function(){t.resetMessages()}}}})}}]}}]),i.directive("editMenu",["$location","CONFIG",function(e,t){var n=["make_attempt","previous_attempts"],r=["/attempt","/previous"];return t.capabilities.manage_word_blocks&&(r.push("/words"),n.push("edit_word_blocks")),t.capabilities.manage_settings&&(r.push("/settings"),n.push("edit_attempt_settings")),t.capabilities.view_attempts&&(r.push("/attempts"),n.push("report_attempts")),{restrict:"E",replace:!0,scope:{},templateUrl:t.partialsUrl+"directives/editMenu.twig",controller:["$scope",function(s){s.canFeedback=t.canFeedback;var o,i;for(s.menu=[],o=0,i=r.length;i>o;++o){var c=e.path().split("/"),a=!1;r[o]==="/"+c[1]&&(a=!0),s.menu.push({route:t.menuUrl+"#"+r[o],title:t.messages["menu_"+n[o]],active:a})}}]}}]),i.directive("alerts",["CONFIG",function(e){return{restrict:"E",replace:!0,scope:{messages:"="},templateUrl:e.partialsUrl+"directives/alerts.twig",link:function(e,t){t.find("button").bind("click",function(){e.$apply(function(){e.success=e.error=e.warning=!1,e.msg=""})})},controller:["$scope",function(e){e.success=e.error=e.warning=!1,e.$watch("messages.success",function(){"string"==typeof e.messages.success&&(e.msg=e.messages.success,e.success=!0,e.error=e.warning=!1,e.messages={})},!0),e.$watch("messages.error",function(){"string"==typeof e.messages.error&&(e.msg=e.messages.error,e.error=!0,e.success=e.warning=!1,e.messages={})},!0),e.$watch("messages.warning",function(){"string"==typeof e.messages.warning&&(e.msg=e.messages.warning,e.warning=!0,e.success=e.error=!1,e.messages={})},!0)}]}}]),i.directive("tagSelect",["CONFIG",function(e){return{restrict:"E",replace:!1,scope:{tags:"=",tagId:"=",saveTag:"&",stopAutoRefresh:"&",startAutoRefresh:"&"},templateUrl:e.partialsUrl+"directives/tagSelect.twig",link:function(e,t){t.mousedown(function(){e.stopAutoRefresh()}),e.selectedTag=e.tagId},controller:["$scope",function(e){e.$watch("selectedTag",function(){e.tagId!==e.selectedTag&&(e.saveTag({tag:e.selectedTag}),e.tagId=e.selectedTag,e.startAutoRefresh())})}]}}]),i.directive("wordBlockListItem",["$timeout","CONFIG",function(e,t){return{restrict:"A",replace:!1,scope:{block:"=",tags:"=",editBlock:"&",deleteBlock:"&",stopAutoRefresh:"&",startAutoRefresh:"&"},templateUrl:t.partialsUrl+"directives/wordBlockListItem.twig",controller:["$scope",function(t){t.editing=!1,t.enableEditing=function(){t.editing=!0,t.stopAutoRefresh(),t.oldblock=t.block.wordblock,e(function(){t.elem.focus()},1)},t.disableEditing=function(){t.editing=!1,t.oldblock!==t.block.wordblock&&t.editBlock({wordblock:t.block.wordblock}),t.startAutoRefresh()},t.saveTag=function(e){t.block.tagid=e,t.editBlock({wordblock:t.block.wordblock})}}],link:function(e,t){e.elem=t.find("input")[0],t.bind("keyup",function(t){!e.editing||13!==t.which&&27!==t.which||e.$apply(function(){e.editing=!1,13===t.which?e.disableEditing():27===t.which&&(e.block.wordblock=e.oldblock,e.startAutoRefresh())})})}}}]),i.directive("attemptListItem",["CONFIG",function(e){return{restrict:"A",replace:!1,scope:{attempt:"="},templateUrl:e.partialsUrl+"directives/attemptListItem.twig"}}]),i.directive("sentenceListItem",["$timeout","CONFIG",function(e,t){return{restrict:"A",replace:!1,scope:{sentence:"=",deleteSentence:"&"},templateUrl:t.partialsUrl+"directives/sentenceListItem.twig",link:function(e){var t=[];e.sentence.wordblocks.forEach(function(e){t.push(e.wordblock)}),e.sentence.string=t.join(" ")}}}]),i.directive("draggableWord",["CONFIG",function(e){return{replace:!0,restrict:"E",scope:{block:"=",tag:"=",displayLabels:"="},templateUrl:e.partialsUrl+"directives/draggableWord.twig"}}]),i.directive("dragdropKey",["CONFIG",function(e){return{restrict:"E",scope:{tags:"="},templateUrl:e.partialsUrl+"directives/dragdropKey.twig",controller:["$scope",function(e){e.groupedTags=[],e.groupTags=function(){e.tags.forEach(function(t,n){var r=t.type;r in e.groupedTags||(e.groupedTags[r]={heading:t.typeName,tags:[]}),e.groupedTags[r].tags.push(n)})},e.$watch("tags",function(){e.tags&&e.groupTags()})}]}}]),i.directive("dropAreaDock",["CONFIG",function(e){return{restrict:"E",scope:{blocks:"=",loading:"=",displayLabels:"=",tags:"=",removeWordBlock:"&",rendered:"="},controller:["$scope",function(e){e.getLabelText=function(t){for(var n in e.tags)if(e.tags[n].id===t)return e.tags[n].abbreviation;return""}}],link:function(e,t){t.bind("drop",function(t,n){e.removeWordBlock({id:angular.element(n.draggable).attr("id")}),e.$apply()})},templateUrl:e.partialsUrl+"directives/dropareaDock.twig"}}]),i.directive("dropArea",["CONFIG","$interval",function(e,t){return{restrict:"E",scope:{placed:"=",setLoading:"&",rendered:"="},controller:["$scope",function(e){e.blockMargin=5,e.droppedBlocks=new o["default"],e.canvas=null,e.intervalPromise={initialise:null,placeBlocks:null},e.$on("wordRemoved",function(t,n){e.droppedBlocks.blocks[n]=null,e.placed.wordblocks=e.droppedBlocks.getSortedBlocks()}),e.$on("sentenceReset",function(){e.droppedBlocks.blocks=[],e.placed.wordblocks=e.droppedBlocks.getSortedBlocks()}),e.$on("sentenceLoaded",function(){e.intervalPromise.placeBlocks=t(function(){e.positionLoadedBlocks()},100)}),e.initialiseCanvas=function(){Math.round(angular.element("#dock-area").innerHeight())<=2*e.blockMargin||(t.cancel(e.intervalPromise.initialise),angular.element("#droparea").height(2*angular.element("#dock-area").height()),e.defineCanvas(),e.droppedBlocks.setCanvas(e.canvas))},e.intervalPromise.initialise=t(function(){e.initialiseCanvas()},100),e.defineCanvas=function(){var t=0;angular.element("#dock-area").children().each(function(){angular.element(this).height()>t&&(t=angular.element(this).outerHeight())});var n=t+2*e.blockMargin,r=Math.floor(angular.element("#droparea").height()/n);e.canvas={width:angular.element("#droparea").outerWidth(),left:angular.element("#droparea").offset().left,top:angular.element("#droparea").offset().top,lineHeight:n,lines:r,blockMargin:e.blockMargin}},e.positionLoadedBlocks=function(){null!==e.canvas&&(e.placed.wordblocks.forEach(function(t){var n=angular.element("#"+t.wordblockid),r={wordblockid:t.wordblockid,height:n.height(),width:n.outerWidth()+2*e.blockMargin,top:parseInt(t.top),left:parseInt(t.left)};e.droppedBlocks.addDroppedBlock(r,n)}),t.cancel(e.intervalPromise.placeBlocks),e.setLoading({loading:!1}),e.placed.wordblocks=e.droppedBlocks.getSortedBlocks())}}],link:function(e,t){var n=function(t){var n=t-e.canvas.top,r=Math.ceil((n+e.canvas.lineHeight/2)/e.canvas.lineHeight);return 0>=r&&(r=1),r>e.canvas.lines&&r--,(r-1)*e.canvas.lineHeight},r=function(t,n){var r=t-e.canvas.left;return 0>r?r=0:r+n>e.canvas.width&&(r=e.canvas.width-n),r};t.bind("drop",function(t,s){e.defineCanvas(),e.droppedBlocks.setCanvas(e.canvas);var o=angular.element(s.draggable),i=n(o.offset().top),c=r(o.offset().left,o.outerWidth()),a={wordblockid:o.attr("id"),height:o.height(),width:o.outerWidth()+2*e.blockMargin,top:i,left:c};e.droppedBlocks.addDroppedBlock(a,o),e.placed.wordblocks=e.droppedBlocks.getSortedBlocks(),e.$apply()})},templateUrl:e.partialsUrl+"directives/droparea.twig"}}]),i.directive("attemptReportListItem",["CONFIG",function(e){return{restrict:"A",replace:!0,scope:{attempt:"=",messages:"=",viewAttempts:"&"},templateUrl:e.partialsUrl+"directives/attemptReportListItem.twig",controller:["$scope",function(e){e.attempt.numattempts||(e.attempt.numattempts=0),e.attempt.lastattempt||(e.attempt.lastattempt_formatted="-")}]}}]),i.directive("reportPagination",["CONFIG",function(e){return{restrict:"E",replace:!1,scope:{perPage:"@",currentPage:"=",total:"=",fetchPage:"&"},templateUrl:e.partialsUrl+"directives/pagination.twig",controller:["$scope",function(e){e.currentPage=0,e.pageCount=0,e.pages=[],e.calculatePageCount=function(){0===e.total?e.pageCount=1:e.pageCount=Math.ceil(e.total/e.perPage)},e.calculatePages=function(){var t,n,r;for(t=1,n=e.pageCount,e.pages=[],r=t;n>=r;++r)e.pages.push(r)},e.$watch("currentPage",function(t,n){n!==t&&(e.fetchPage(e.currentPage),e.calculatePages())}),e.$watch("total",function(){e.calculatePageCount(),e.calculatePages()}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t},e.nextPage=function(){e.currentPage<e.pageCount-1&&e.currentPage++},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount-1?"disabled":"";return t},e.pageDisabled=function(t){var n=e.currentPage===t;return n},e.gotoPage=function(t){e.currentPage=t}}]}}]),i.directive("commentListItem",["$timeout","CONFIG",function(e,t){return{restrict:"A",replace:!1,scope:{comment:"=",tags:"=",editComment:"&",deleteComment:"&",stopAutoRefresh:"&",startAutoRefresh:"&",manage:"="},templateUrl:t.partialsUrl+"directives/commentListItem.twig",controller:["$scope",function(t){t.editing=!1,t.enableEditing=function(){t.editing=!0,t.stopAutoRefresh(),t.oldcomment=t.comment.comment,e(function(){t.elem.focus()},1)},t.disableEditing=function(){t.editing=!1,t.oldcomment!==t.comment.comment&&t.editComment(t.comment.comment),t.startAutoRefresh()}}],link:function(e,t){e.elem=t.find("textarea"),t.bind("keyup",function(t){e.editing&&27===t.which&&e.$apply(function(){e.editing=!1,27===t.which&&(e.comment.comment=e.comment,e.startAutoRefresh())})})}}}])},{"./dropped-block":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(){this.canvas={},this.blocks=[],this.blocksToPlace=[],this.elements=[],this.addDroppedBlock=function(e,t){return this.blocks[e.wordblockid]=e,this.elements[e.wordblockid]=t,this.positionBlock(e.wordblockid),e},this.setCanvas=function(e){this.canvas=e},this.cloneArray=function(e){var t=[];for(var n in e)e[n]&&(t[n]=jQuery.extend({},e[n]));return t},this.getCollisions=function(e){var t=this.cloneArray(this.blocksToPlace);t.sort(this.sortBlocksByPosition);var n=[];return t.forEach(function(t){t.wordblockid!==e.wordblockid&&t.top===e.top&&t.left+t.width>e.left&&e.left+e.width>t.left&&n.push(t.wordblockid)}),n},this.getSortedBlocks=function(){var e=this.blocks.filter(function(e){return null!==e});return e.sort(this.sortBlocksByPosition),e},this.sortBlocksByPosition=function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.left>t.left?1:e.left<t.left?-1:0},this.positionElement=function(e){var t=this.elements[e.wordblockid];t.offset({top:e.top+this.canvas.top,left:e.left+this.canvas.left})},this.positionElements=function(){for(var e in this.blocksToPlace)null!==this.blocksToPlace[e]&&this.positionElement(this.blocksToPlace[e])},this.positionBlock=function(e){this.blocksToPlace=this.cloneArray(this.blocks);var t=this.blocksToPlace[e],n=this.getCollisions(t);if(0===n.length)return this.blocksToPlace=[],void this.positionElement(t);var r=this.blocksToPlace[n[0]];this.intersectsOnTheRight(t,r)?this.resolveCollisionRight(t,r):this.resolveCollisionLeft(t,r),this.positionElements(),this.blocks=this.cloneArray(this.blocksToPlace),this.blocksToPlace=[]},this.resolveCollisionRight=function(e,t){var n=this.isSpaceOnLineRight(t.left+t.width,e.width);n?this.moveRightOfPosition(e,t.left+t.width):(e.left=this.canvas.width+2*this.canvas.blockMargin-e.width,this.cascadeLeft(e)),this.cascadeRight(e)||(this.blocksToPlace=this.cloneArray(this.blocks),e=this.blocksToPlace[e.wordblockid],this.moveLeftOfPosition(e,t.left+t.width),this.cascadeLeft(e))},this.resolveCollisionLeft=function(e,t){var n=this.isSpaceOnLineLeft(t.left,e.width);n?this.moveLeftOfPosition(e,t.left):e.left=0,this.cascadeLeft(e)||(this.blocksToPlace=this.cloneArray(this.blocks),e=this.blocksToPlace[e.wordblockid],this.cascadeRight(e))},this.cascadeLeft=function(e){var t=this,n=this.getCollisions(e);if(0===n.length)return!0;var r=0;n.forEach(function(e){r+=t.blocks[e].width;
});var s=e.top/this.canvas.lineHeight+1;if(1===s&&!this.isSpaceOnLineLeft(e.left,r))return!1;var o=e.left;return n.forEach(function(e){var n=t.blocksToPlace[e];return t.moveLeftOfPosition(n,o),t.cascadeLeft(n)?void 0:!1}),!0},this.cascadeRight=function(e){var t=this,n=this.getCollisions(e);if(0===n.length)return!0;n.reverse();var r=0;n.forEach(function(e){r+=t.blocks[e].width});var s=e.top/this.canvas.lineHeight+1;if(s===this.canvas.lines&&!this.isSpaceOnLineRight(e.left+e.width,r))return!1;var o=e.left;return n.forEach(function(n){var r=t.blocksToPlace[n];return t.moveRightOfPosition(r,e.width+o),t.cascadeRight(r)?void 0:!1}),!0},this.intersectsOnTheRight=function(e,t){return t.left+t.width/2<e.left+e.width/2},this.moveRightOfPosition=function(e,t){this.isSpaceOnLineRight(t,e.width)?e.left=t:(e.left=0,e.top+=this.canvas.lineHeight)},this.moveLeftOfPosition=function(e,t){this.isSpaceOnLineLeft(t,e.width)?e.left=t-e.width:(e.left=this.canvas.width+2*this.canvas.blockMargin-e.width,e.top-=this.canvas.lineHeight)},this.isSpaceOnLineLeft=function(e,t){return e>=t},this.isSpaceOnLineRight=function(e,t){var n=this.canvas.width+2*this.canvas.blockMargin-e;return n>=t}},t.exports=n["default"]},{}],6:[function(e,t,n){"use strict";var r=angular.module("dragdrop.filters",[]);r.filter("range",function(){return function(e,t,n){t=parseInt(t),n=parseInt(n)+1;for(var r=n>=t?1:-1;t!==n;)e.push(t),t+=r;return e}})},{}],7:[function(e,t,n){"use strict";var r=angular.module("dragdrop.services",[]);r.service("apiSrv",["$http","$q","CONFIG",function(e,t,n){var r=n.apiUrl;this.getAll=function(n,s){var o=t.defer();return s="undefined"==typeof s?"":"?"+jQuery.param(s),e.get(r+n+"/"+s).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.get=function(n,s){var o=t.defer();return e.get(r+n+"/"+s).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.post=function(s,o,i){var c=t.defer(),a=r+s+"/?sesskey="+n.sesskey;return"undefined"!=typeof i&&(a+="&"+jQuery.param(i)),e.post(a,o).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.put=function(s,o,i,c){var a=t.defer(),l=r+s+"/"+o+"?sesskey="+n.sesskey;return"undefined"!=typeof c&&(l+="&"+jQuery.param(c)),e.put(l,i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this["delete"]=function(s,o,i){var c=t.defer(),a=e["delete"],l=r+s+"/"+o+"?sesskey="+n.sesskey;return"undefined"!=typeof i&&(l+="&"+jQuery.param(i)),a(l).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.getAttempts=function(n,s,o){var i=t.defer(),c=r+"attempts/?limitfrom="+n*s+"&limitnum="+s+"&sort="+encodeURIComponent(o.sort)+"&direction="+o.direction+"&q="+encodeURIComponent(o.q);return e.get(c).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getUser=function(n){var s=t.defer();return e.get(r+"user/"+n).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.getUserComments=function(n){var s=t.defer();return e.get(r+"comment/?userid="+n).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.resetAttempts=function(n){var s=t.defer();return e.put(r+"user_attempt/reset/",n).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise}}]),r.service("tagSrv",["$http","$q","CONFIG",function(e,t,n){var r=n.tagUrl;this.get=function(){var n=t.defer();return e.get(r).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}}]),r.service("attemptFilterSrv",[function(){this.filters={q:"",sort:"user",direction:"ASC"}}])},{}]},{},[2]);